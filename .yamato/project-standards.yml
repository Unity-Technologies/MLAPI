{% metadata_file .yamato/project.metafile %}
---

# Project standards are being checked for package (in project context).
# It should be enough to perform the test on default project (testproject) but to make sure that all projects conform to our standards job for each of them will be available.
# Tests are executed for default editor (trunk) on default platform (ubuntu) as in project.metafile declaration since results would be the same across editors and platforms.
{% for project in projects.all -%}
{% for platform in test_platforms.default -%}
{% for editor in validation_editors.default -%}
standards_{{ platform.name }}_{{ project.name }}_{{ editor }}:
  name: Standards Check - NGO {{ project.name }} [{{ platform.name }}, {{ editor }}]
  agent:
    type: {{ platform.type }}
    image: {{ platform.image }}
    flavor: {{ platform.flavor }}
  commands:
    # .NET environment setup
    - dotnet --version
    - dotnet format --version
    
    # Unity setup
    - pip install unity-downloader-cli --upgrade --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple
    - unity-downloader-cli -u {{ editor }} -c editor --wait --fast
    - .Editor/Unity -batchmode -nographics -logFile - -executeMethod Packages.Rider.Editor.RiderScriptEditor.SyncSolution -projectPath {{ project.path }} -quit
      
    # Standards check
    - dotnet run --project=dotnet-tools/netcode.standards -- --project={{ project.path }} --check
{% endfor -%}
{% endfor -%}
{% endfor -%}